# .github/workflows/reusable-notify.yml
name: Reusable Notification

on:
  workflow_call:
    inputs:
      status:
        required: true
        type: string
      enable_slack_notification:
        required: true
        type: boolean
      enable_discord_notification:
        required: true
        type: boolean
    secrets:
      SLACK_WEBHOOK_URL:
        required: false
      DISCORD_WEBHOOK_URL:
        required: false

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Slack Notification on Failure
        if: "${{ inputs.status == 'failure' && inputs.enable_slack_notification }}"
        uses: slackapi/slack-github-action@v1.26.0
        with:
          payload: |
            {
              "text": "CI/CD Pipeline Failed! ðŸš¨",
              "blocks": [
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "*Repository:* ${{ github.repository }}\n*Event:* ${{ github.event_name }}\n*Author:* ${{ github.actor }}\n<${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Workflow Run>"
                  }
                }
              ]
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Send Discord Notification on Failure
        if: "${{ inputs.status == 'failure' && inputs.enable_discord_notification }}"
        uses: tsg-oss/discord-webhook-action@v1
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          title: "CI/CD Pipeline Failed! ðŸš¨"
          description: |
            Repository: ${{ github.repository }}
            Author: ${{ github.actor }}
            Link: <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}>
